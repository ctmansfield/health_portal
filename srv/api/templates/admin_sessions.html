<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Admin â€” Sessions</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="header"><h1>Admin: Sessions</h1></div>
  <div class="container">
    <div class="card">
      <h2>Active Sessions</h2>
      <table id="sessionsTable">
        <thead><tr><th>Session ID</th><th>User ID</th><th>Expires</th><th>Created</th><th></th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
<script>
async function load(){
  const res = await fetch('/admin/sessions');
  const j = await res.json();
  const tbody = document.querySelector('#sessionsTable tbody');
  tbody.innerHTML = '';
  for(const s of j.sessions){
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${s.session_id}</td><td>${s.user_id}</td><td>${s.expires_at}</td><td>${s.created_at}</td><td><button data-sid="${s.session_id}">Revoke</button></td>`;
    tbody.appendChild(tr);
  }
  document.querySelectorAll('button[data-sid]').forEach(b=>b.addEventListener('click', async ev=>{
    const sid = b.getAttribute('data-sid');
    // include CSRF header if present
    const token = document.cookie.split('; ').find(r=>r.startsWith('hp_csrf='));
    const headers = {};
    if(token) headers['x-csrf-token'] = token.split('=')[1];
    const r = await fetch('/admin/sessions/'+sid+'/revoke',{method:'POST', headers, credentials:'same-origin'});
    if(r.ok){ load(); }
  }));
}
load();
</script>
</body>
</html>
