{% extends "base.html" %}
{% block title %}Labs — Critical Series{% endblock %}

{# put scripts in a head block, if base.html supports it #}
{% block head_extra %}
  <script defer src="{{ url_for('static', path='js/chart.umd.min.js') }}"></script>
  <script defer src="{{ url_for('static', path='js/labs_critical_v2.js') }}"></script>
{% endblock %}

{% block content %}
  <p><a href="{{ url_for('dashboard') }}">← Back to dashboard</a></p>
  <h1>Labs — Critical Series</h1>

  <div class="hp-labs-critical" data-person-id="{{ person_id | default('me') }}" data-agg-default="daily">
    <div class="hp-labs-toolbar"></div>
    <div class="hp-labs-body"></div>
  </div>

  {# fallback loader in case base.html doesn't render head_extra #}
  <script>
  (function(){
    if (!window.Chart) {
      function load(u){return new Promise((res,rej)=>{var s=document.createElement('script');s.src=u;s.defer=true;s.onload=res;s.onerror=rej;document.head.appendChild(s);});}
      Promise.resolve()
        .then(()=>load("{{ url_for('static', path='js/chart.umd.min.js') }}"))
        .then(()=>load("{{ url_for('static', path='js/labs_critical_v2.js') }}"))
        .catch(()=>console.warn('labs fallback loader failed'));
    }
  })();
  </script>
{% endblock %}
