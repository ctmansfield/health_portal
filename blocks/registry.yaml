blocks:
  - id: DB-1
    title: Baseline schema & views (report, variant, biomarker; report_exec_summary)
    component: db
    status: done
    weight: 10
    deps: []
    assignee: Chad
    context:
      touches:
        - services/healthdb-pg-0001/migrations/**
      acceptance:
        - "Migrations apply & rollback cleanly"
        - "report_exec_summary returns id,title,result,signed_out_at"

  - id: APP-2
    title: GET /reports/{id} — full clinician payload
    component: app
    status: done
    weight: 20
    deps: [DB-1]
    assignee: Chad
    context:
      touches: [ "srv/api/reports.py", "api/**" ]
      acceptance:
        - "OpenAPI v1 updated"
        - "200 returns canonical payload"
        - "400/404 invalid/missing id"

  - id: APP-3
    title: GET /reports/{id}/summary — dashboard card
    component: app
    status: done
    weight: 30
    deps: [DB-1]
    assignee: Chad
    context:
      touches: [ "srv/api/reports.py", "api/**" ]
      acceptance:
        - "OpenAPI v1 updated"
        - "200 returns summary object"
        - "400/404 invalid/missing id"

  - id: UI-1
    title: Dashboard Summary Card
    component: ui
    status: active
    weight: 40
    deps: [APP-3]
    assignee: Chad
    context:
      touches: [ "app/templates/**", "app/static/js/**", "srv/api/dashboard.py" ]
      acceptance:
        - "Card loads via /ui/reports/{id}/summary-card"
        - "Loading/empty/error states"
        - "No PHI in logs"

  - id: APP-9
    title: Critical series endpoint
    component: app
    status: done
    weight: 90
    deps: [DB-1]
    assignee: Chad
    context:
      touches: [ "srv/api/reports.py", "app/hp_etl/cache.py", "tests/**" ]
      acceptance:
        - "GET /labs/{person_id}/critical-series"
        - "agg=daily|hourly, tz-aware; cache no-store"

  - id: UI-5
    title: Critical Lab Graphs page
    component: ui
    status: done
    weight: 130
    deps: [APP-9]
    assignee: Chad
    context:
      touches: [ "app/templates/components/labs_critical_page.html", "app/static/js/labs_critical_v2.js" ]
      acceptance:
        - "Charts render; export CSV"
        - "Preview tooling works"

  - id: UI-6
    title: Labs interactions (zoom/pan + agg toggle)
    component: ui
    status: active
    weight: 135
    deps: [UI-5]
    assignee: Chad
    context:
      touches: [ "app/static/js/labs_critical_v2.js", "app/templates/components/labs_critical_page.html", "tests/**" ]
      acceptance:
        - "Drag-zoom and pan"
        - "Aggregation toggle persists"

  - id: APP-10
    title: Reference ranges & flagging (APP-9)
    component: app
    status: active
    weight: 136
    deps: [APP-9]
    assignee: Chad
    context:
      touches: [ "srv/api/reports.py", "tests/**" ]
      acceptance:
        - "include=refs returns ref_low/ref_high"
        - "Per-point flag L/H/null"

  - id: UI-7
    title: Ref bands + legend + Export all
    component: ui
    status: active
    weight: 137
    deps: [UI-5, APP-10]
    assignee: Chad
    context:
      touches: [ "app/static/js/labs_critical_v2.js", "app/templates/components/labs_critical_page.html", "tests/**" ]
      acceptance:
        - "Ref band shaded"
        - "Legend toggles metrics"
        - "Export all metrics CSV/zip"

  - id: APP-11
    title: Downsampling & cache-key polish (APP-9)
    component: app
    status: active
    weight: 138
    deps: [APP-9]
    assignee: Chad
    context:
      touches: [ "srv/api/reports.py", "tests/**" ]
      acceptance:
        - "?max_points bounds series length"
        - "Cache key includes agg/max_points/include + ETL version"
